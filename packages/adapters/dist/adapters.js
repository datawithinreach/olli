!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.OlliAdapters=t():e.OlliAdapters=t()}(this,(()=>(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{ObservablePlotAdapter:()=>r,VegaAdapter:()=>v,VegaLiteAdapter:()=>A});var n=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,a=t.length;i<a;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))},r=function(e,t){return u(e)||function(e){var t=e.marks.find((function(e){return"line"===e.ariaLabel}));return t&&t.channels.some((function(e){return"stroke"===e.name}))}(e)?function(e,t){var n="svg"!==t.tagName?Object.values(t.children).find((function(e){return"svg"===e.tagName})):t,r=["x-axis","y-axis"].reduce((function(t,r){var i=c(n,r);return i&&t.push(a(e,i)),t}),[]),l=[];e.color&&e.color.legend&&l.push(o(e,t.children[0]));var s=e.marks.filter((function(e){return"rule"!==e.ariaLabel}))[0],d=r.concat(l).reduce((function(e,t){return e.concat(t.field)}),[]),f=new Map,p=e.facet?e.facet.y?e.facet.y:e.facet.x:e.marks.find((function(e){return"line"===e.ariaLabel})).channels.find((function(e){return"stroke"===e.name})).value;if(d.push(p),u(e))f=new Map(Object.values(n.children).filter((function(e){return"facet"===e.getAttribute("aria-label")})).map((function(t){return[t.__data__,i(e,n)]})));else{var m=s.data.reduce((function(e,t){return e.includes(t[p])||e.push(t[p]),e}),[]);f=new Map(m.map((function(t){return[t,i(e,n)]})))}return f.forEach((function(e){return e.legends=JSON.parse(JSON.stringify(l))})),{type:"facetedChart",charts:f,data:s.data,dataFieldsUsed:d,description:"Faceted chart",facetedField:p}}(e,t):i(e,t)};function i(e,t){var r=["x-axis","y-axis"].reduce((function(n,r){var i=c("svg"!==t.tagName?Object.values(t.children).find((function(e){return"svg"===e.tagName})):t,r);return i&&n.push(a(e,i)),n}),[]),i=[];e.color&&e.color.legend&&i.push(o(e,t.children[0]));var u=e.marks.filter((function(e){return"rule"!==e.ariaLabel}))[0],s=r.concat(i).reduce((function(e,t){return e.concat(t.field)}),[]),d={axes:r,type:"chart",legends:i,data:u.data,dataFieldsUsed:s,description:"A chart with ".concat(u.ariaLabel," marks"),gridNodes:[]};return"[Undefined]"!==l(u.ariaLabel)&&(d.markUsed=l(u.ariaLabel),function(e,t){switch(t){case"rect":e.axes=e.axes.filter((function(e){return"band"===e.scaleType}));break;case"geoshape":break;case"point":e.title&&(e.title="Scatter plot with title ".concat(e.title," ")),e.axes.every((function(e){return"number"==typeof e.values[0]}))&&(e.gridNodes=n([],e.axes,!0))}}(d,d.markUsed)),d}function a(e,t){var r="y-axis"===(null==t?void 0:t.getAttribute("aria-label"))?"y":"x",i="y"===r?"left":"bottom",a=e.marks.filter((function(e){return"rule"!==e.ariaLabel}))[0],o=a.channels.find((function(e){return e.scale===r})),c="object"==typeof o.value?o.value.label:o.value,u=Object.keys(t.children).reduce((function(e,n){var r=t.children[parseInt(n)],i="";return"tick"===r.classList[0]&&r.childNodes.forEach((function(e){""!==e.textContent&&(i=e.textContent)})),""!==i&&(isNaN(parseInt(i))?e.push(i):e.push(parseInt(i.replace(/,/g,"")))),e}),[]),l={values:n([],u,!0),title:"".concat(null==t?void 0:t.getAttribute("aria-label")," titled ").concat(c),data:a.data,field:c,orient:i};return o.type&&(l.scaleType=o.type),l}function o(e,t){var n=e.marks.filter((function(e){return"rule"!==e.ariaLabel}))[0],r=n.channels.find((function(e){return"color"===e.scale})),i=Object.keys(t.children).reduce((function(e,n){var r=t.children[parseInt(n)];return"STYLE"!==r.nodeName&&(isNaN(parseInt(r.textContent))?e.push(r.textContent):e.push(parseInt(r.textContent.replace(/,/g,"")))),e}),[]),a="object"==typeof r.value?r.value.label:r.value,o={values:i,data:n.data,field:a,title:a,type:"ordinal"};return"[Undefined]"!==l(n.ariaLabel)&&(o.markUsed=l(n.ariaLabel)),e.color.type&&(o.type=e.color.type),o}function c(e,t){var n;return Object.keys(e.children).forEach((function(r){var i=e.children[parseInt(r)];i.getAttribute("aria-label")===t&&(n=i)})),n}function u(e){return e.facet}function l(e){switch(e){case"dot":return"point";case"bar":return"rect";case"line":return"line";default:return"[Undefined]"}}var s,d,f=function(){return f=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},f.apply(this,arguments)},p=function(e){return f(f({},e),{type:"chart"})},m=function(e){return f(f({},e),{type:"facetedChart"})},v=function(e,t){return e.items.some((function(e){return"scope"===e.role}))?y():g(e)};function y(){var e,t,n=function(e){var t=[];return e.forEach((function(e){t.every((function(t){return JSON.stringify(t)!==JSON.stringify(e)}))&&t.push(e)})),t},r=function(e,t){e.forEach((function(e){var n=Object.assign({},e);n.data=JSON.parse(JSON.stringify(e.data)),t.push(n)}))},i=b(d),a=n(N(s,"axis").map((function(e){return x(e)}))),o=n(N(s,"legend").map((function(e){return k(e)}))),c=s.items.filter((function(e){return"scope"===e.role}))[0].items,u=O(a,o),l=(null===(e=d.marks)||void 0===e?void 0:e.find((function(e,t){return e.from&&e.from.facet})).from).facet.groupby;t=Array.isArray(l)?l[0]:l,u.push(t);var f=new Map(c.map((function(e){var n=g(e),i=e.datum[t];return n.title=N(e,"title-text").length>0?N(e,"title-text")[0].items[0].text:"",r(a,n.axes),r(o,n.legends),[i,n]})));return m({charts:f,data:h(),dataFieldsUsed:u,description:i,facetedField:t})}function g(e){var t=b(d),n=N(e,"axis").map((function(e){return x(e)})),r=N(e,"legend").map((function(e){return k(e)})),i=O(n,r),a=h(),o=N(e,"title").length>0?N(e,"title")[0].items[0].items[0].items[0].text:void 0,c=p({data:a,axes:n,legends:r,description:t,gridNodes:[],dataFieldsUsed:i});return o&&(c.title=o),c}function h(){try{return function(e,t,n){if(n||2===arguments.length)for(var r,i=0,a=t.length;i<a;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}([],s.context.data.source_0.values.value,!0)}catch(e){throw new Error("No data defined in the Vega Spec \n ".concat(e))}}function b(e){return e.description?e.description:"[Root]"}function x(e){var t,n,r,i,a,o,c=e.items[0],u=c.items.find((function(e){return"axis-tick"===e.role})).items.map((function(e){return e.datum.value})),l=c.items.find((function(e){return"axis-title"===e.role})),s=c.datum.scale,f=null===(n=null===(t=d.scales)||void 0===t?void 0:t.find((function(e){return e.name===s})))||void 0===n?void 0:n.domain;f||null===(r=d.marks)||void 0===r||r.forEach((function(e){var t=e.scales;if(t){var n=t.find((function(e){return e.name===s}));n&&(f=n.domain)}})),o=void 0!==f.field?f.field:f.fields;var p="bottom"===c.orient||"top"===c.orient?"X-Axis":"Y-Axis",m=c.orient;return{values:u,title:void 0===l?p:"".concat(p," titled '").concat(l.items[0].text,"'"),data:h(),field:o,scaleType:null===(a=null===(i=d.scales)||void 0===i?void 0:i.find((function(e){return e.name===s})))||void 0===a?void 0:a.type,orient:m}}function k(e){var t,n,r,i,a,o=e.items[0].datum.scales[Object.keys(e.items[0].datum.scales)[0]],c=h(),u=e.items[0].items.find((function(e){return"legend-entry"===e.role})).items[0].items[0].items,l=e.items[0].items.find((function(e){return"legend-title"===e.role})).items[0].text,s=null===(n=null===(t=d.scales)||void 0===t?void 0:t.find((function(e){return e.name===o})))||void 0===n?void 0:n.domain;return s.field?a=s.field:Object.keys(c[0]).some((function(e){return e.toLocaleString()===l.toLocaleLowerCase()}))&&(a=l.toLocaleLowerCase()),{values:u.map((function(e){return e.items.find((function(e){return"legend-label"===e.role})).items[0].datum.value})),title:l,data:c,field:a,scaleType:null===(i=null===(r=d.scales)||void 0===r?void 0:r.find((function(e){return e.name===o})))||void 0===i?void 0:i.type,type:""}}function O(e,t){var n=[],r=function(e){Object.keys(e).forEach((function(t){var r=e[t].field;"string"!=typeof r?r.forEach((function(e){n.push(e)})):n.push(r)}))};return r(e),r(t),n}function N(e,t){var n=[],r=["cell","axis-grid"];return void 0===e.items||e.items.forEach((function(e){void 0!==e.role&&e.role===t&&j(e,r)?n.push(e):n=n.concat(N(e,t))})),n}function j(e,t){return void 0===e.role||t.some((function(t){return e.role.includes(t)}))?void 0===e.role&&void 0!==e.items?e.items.every((function(e){return j(e,t)})):void 0===e.role&&void 0===e.items:!(!e.items.every((function(e){return j(e,t)}))&&void 0!==e.items)}var A=function(e,t){return e.items.some((function(e){return"scope"===e.role}))?function(e,t){var n=function(e){var t=[];return e.forEach((function(e){t.every((function(t){return JSON.stringify(t)!==JSON.stringify(e)}))&&t.push(e)})),t},r=function(e,t){e.forEach((function(e){var n=Object.assign({},e);n.data=JSON.parse(JSON.stringify(e.data)),t.push(n)}))},i=n(C(e,"axis").map((function(n){return S(e,n,t)}))),a=n(C(e,"legend").map((function(n){return L(e,n,t)}))),o=i.concat(a).reduce((function(e,t){return e.concat(t.field)}),[]),c=void 0!==t.encoding.facet?t.encoding.facet.field:t.encoding.color.field,u=new Map(e.items.filter((function(e){return"scope"===e.role}))[0].items.map((function(e){var n=w(e,t);return r(i,n.axes),r(a,n.legends),J(n,n.markUsed,t),[e.datum[c],n]}))),l=m({description:"",data:E(e),dataFieldsUsed:o,charts:u,facetedField:c});return l.dataFieldsUsed.push(c),U(l,t),l}(e,t):w(e,t)};function w(e,t){var n=C(e,"axis").map((function(n){return S(e,n,t)})),r=C(e,"legend").map((function(n){return L(e,n,t)})),i=n.concat(r).reduce((function(e,t){return e.concat(t.field)}),[]),a=t.mark,o=p({axes:n.filter((function(e){return void 0!==e.field})),legends:r,description:"",dataFieldsUsed:i,gridNodes:[],data:E(e),markUsed:a});return U(o,t),J(o,a,t),o}function S(e,t,n){var r,i=t.items[0],a=i.orient,o="bottom"===a?"x":"y",c=i.items.find((function(e){return"axis-tick"===e.role})).items.map((function(e){return e.datum.value})),u=n.encoding[o].title,l=(i.datum.scale,E(e)),s="bottom"===i.orient||"top"===i.orient?"X-Axis":"Y-Axis";return r=n.encoding[o].aggregate?Object.keys(l[0]).filter((function(e){return e.includes(n.encoding[o].field)})):n.encoding[o].field,{values:c,title:void 0===u?s:"".concat(s," titled '").concat(u,"'"),data:l,field:r,scaleType:n.encoding[o].type,orient:a,markUsed:n.mark}}function L(e,t,n){var r,i,a=t.items[0].datum.scales[Object.keys(t.items[0].datum.scales)[0]],o=E(e);return{values:t.items[0].items.find((function(e){return"legend-entry"===e.role})).items[0].items[0].items.map((function(e){return e.items.find((function(e){return"legend-label"===e.role})).items[0].datum.value})),title:n.encoding.color.title?n.encoding.color.title:n.encoding.color.field,data:o,field:n.encoding.color.field,scaleType:null===(i=null===(r=n.scales)||void 0===r?void 0:r.find((function(e){return e.name===a})))||void 0===i?void 0:i.type,type:n.encoding.color.type,markUsed:n.mark}}function U(e,t){var n=t.description?t.description:"";"facetedChart"===e.type?(n="".concat(n," with ").concat(e.charts.size," faceted charts."),e.description=t.description):e.description="".concat(n)}function E(e,t){try{return e.context.data.source_0.values.value}catch(e){throw new Error("No data defined in the Spec \n ".concat(e))}}function C(e,t){var n=[],r=["cell","axis-grid"];return void 0===e.items||e.items.forEach((function(e){void 0!==e.role&&e.role===t&&F(e,r)?n.push(e):n=n.concat(C(e,t))})),n}function F(e,t){return void 0===e.role||t.some((function(t){return e.role.includes(t)}))?void 0===e.role&&void 0!==e.items?e.items.every((function(e){return F(e,t)})):void 0===e.role&&void 0===e.items:!(!e.items.every((function(e){return F(e,t)}))&&void 0!==e.items)}function J(e,t,n){switch(t){case"bar":var r=Object.keys(n.encoding).filter((function(e){return"nominal"===n.encoding[e].type||void 0===n.encoding[e].aggregate}))[0];e.axes=e.axes.filter((function(e){return e.title.toLowerCase().includes("".concat(r,"-axis"))}));break;case"geoshape":break;case"point":e.title&&(e.title="Scatter plot with title ".concat(e.title," ")),e.gridNodes=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,a=t.length;i<a;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}([],e.axes,!0)}}return t})()));